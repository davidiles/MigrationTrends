---
title: "National trend analysis using migration counts and stable isotopes"
author: "Dave Iles"
date: "October 2, 2019"
fontsize: 10pt
output:
  rmarkdown::pdf_document:
    fig_width: 4
    fig_height: 3
    fig_caption: yes        
    includes:  
      in_header: preamble-latex.tex
---

```{r global_options, include = FALSE}
knitr::opts_chunk$set(message=FALSE, 
                      tidy.opts=list(width.cutoff=60)) 
```

```{r setup, include=FALSE}
# Setup options
knitr::opts_chunk$set(echo = FALSE, include = FALSE, message = FALSE,dpi=300)

setwd("~/Projects/MigrationTrends/scripts")

# Required packages
my.packs <- c(
  
  'tidyverse','reshape2','viridis','jagsUI',
  
  'knitr', 'kableExtra')

# if any of them are not installed, install them
if (any(!my.packs %in% installed.packages()[, 'Package'])) {install.packages(my.packs[which(!my.packs %in% installed.packages()[, 'Package'])],dependencies = TRUE)}
lapply(my.packs, require, character.only = TRUE)

rm(list=ls())

```

### Read in data from BSC

Data provided by Danielle Ethier (BSC).  Has been pre-processed/cleaned.  Does not include offsets or effort (i.e., hours nets were open).

```{r}
dat_can <- rbind(read.csv("../data/migration_counts/CAN/LPBO.BLPW.2018.csv") %>% add_column(., station = "LPBO"),
               read.csv("../data/migration_counts/CAN/PEPBO.BLPW.2018.csv") %>% add_column(., station = "PEPBO"),
               read.csv("../data/migration_counts/CAN/TCBO.BLPW.2018.csv") %>% add_column(., station = "TCBO"))


# Number of days with data each year at each station
#n.days.per.station <- aggregate(doy~YearCollected + SurveyAreaIdentifier + season, data = dat_1, FUN = length)

#plot.fall <- ggplot(data = subset(dat_1, season == "Fall")) +
#  geom_line(aes(x = doy, y = ObservationCount), col = "blue")+
# facet_grid(SurveyAreaIdentifier ~ YearCollected, scales = "free")+
# theme_bw()

#print(plot.fall)

```

```{r}
#plot.spring <- ggplot(data = subset(dat_1, season == "Spring")) +
#  geom_line(aes(x = doy, y = ObservationCount), col = "blue")+
#  facet_grid(SurveyAreaIdentifier ~ YearCollected, scales = "free")+
#  theme_bw()

#print(plot.spring)
```

### Read in data from US stations

Data provided by Ricky Dunn.  Has been pre-processed/cleaned.  Includes "net hours" that can be used as offsets.

```{r}
dat_usa <- rbind(readxl::read_xlsx("../data/migration_counts/USA/Cleaned BLPW - AIMS spring.xlsx") %>% as.data.frame() %>% add_column(., season = "Spring"),
               
               readxl::read_xlsx("../data/migration_counts/USA/Cleaned BLPW - BIBS fall.xlsx") %>% as.data.frame() %>% add_column(., season = "Fall"),
               
               readxl::read_xlsx("../data/migration_counts/USA/Cleaned BLPW - BSBO fall.xlsx") %>% as.data.frame() %>% add_column(., season = "Fall"),
               
               readxl::read_xlsx("../data/migration_counts/USA/Cleaned BLPW - BSBO spring.xlsx") %>% as.data.frame() %>% add_column(., season = "Spring"),
               
               
               readxl::read_xlsx("../data/migration_counts/USA/Cleaned BLPW - FBBS spring.xlsx") %>% as.data.frame() %>% add_column(., season = "Spring"),
               
               readxl::read_xlsx("../data/migration_counts/USA/Cleaned BLPW - MCCS fall.xlsx") %>% as.data.frame() %>% add_column(., season = "Fall"),
               
               readxl::read_xlsx("../data/migration_counts/USA/Cleaned BLPW - MCCS spring.xlsx") %>% as.data.frame() %>% add_column(., season = "Spring"),
               
               readxl::read_xlsx("../data/migration_counts/USA/Cleaned BLPW - FBBS fall.xlsx") %>% as.data.frame() %>% add_column(., season = "Fall"),
               
               readxl::read_xlsx("../data/migration_counts/USA/Cleaned BLPW - KWRS fall.xlsx") %>% as.data.frame() %>% add_column(., season = "Fall"))
               
#datasets with different column names

tmp = readxl::read_xlsx("../data/migration_counts/USA/Cleaned BLPW - PARC fall.xlsx") %>% as.data.frame() %>% add_column(., season = "Fall")
               
colnames(tmp) <- colnames(dat_usa)

dat_usa <- rbind(dat_usa, tmp)
rm(tmp)               

```

